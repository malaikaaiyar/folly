---
import { getCollection } from "astro:content";
import { formatTitle } from "../utils.js";
import { site } from "../site";

interface Props {
  volume: 1 | 2;
}

const { volume } = Astro.props;

const volumeConfig = {
  1: { title: "Volume 1", date: "5 May 2025" },
  2: { title: "Volume 2", date: "1 February 2026" },
};

const allArticles = await getCollection("articles", ({ data }) => data.published === true);
const volumeArticles = allArticles.filter((a) => a.data.volume === volume);

const order = site.volumeOrder?.[volume] ?? [];
const articles = volumeArticles.sort((a, b) => {
  const aIdx = order.indexOf(a.slug);
  const bIdx = order.indexOf(b.slug);
  if (aIdx === -1 && bIdx === -1) return a.data.title.localeCompare(b.data.title);
  if (aIdx === -1) return 1;
  if (bIdx === -1) return -1;
  return aIdx - bIdx;
});

const config = volumeConfig[volume];
---

<div class="magazine-content">
  <div class="content-container">
    <div class="volume-header">
      <h2 class="page-title page-title--with-subtitle">{config.title}</h2>
      <!-- <p class="volume-date">{config.date}</p> -->
    </div>
    <div class="articles-preview">
      {articles.map((article) => (
        <article class="article-preview">
          <h2 class="article-title">
            <a href={`/articles/${article.slug}`} set:html={formatTitle(article.data.title)}></a>
          </h2>
          <p class="article-meta">{article.data.author} | {article.data.category}</p>
          {article.data.description && (
            <p class="article-excerpt" set:html={article.data.description} />
          )}
        </article>
      ))}
    </div>
  </div>
</div>

<style>
  .magazine-content {
    background: var(--light);
    color: var(--dark);
  }

  .volume-header {
    margin-bottom: 3rem;
  }

  .page-title--with-subtitle {
    margin-bottom: 0.25rem;
  }

  .volume-date {
    font-family: 'Libre Baskerville', serif;
    font-size: 0.95rem;
    color: var(--dark);
    opacity: 0.9;
    margin: 0;
  }

  .articles-preview {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .article-preview {
    max-width: 100%;
  }

  .article-title {
    font-family: 'Libre Baskerville', serif;
    font-size: 2rem;
    font-weight: 400;
    line-height: 1.2;
    margin: 0 0 0.25rem 0;
  }

  .article-title a {
    color: var(--dark);
    text-decoration: none;
  }


  .article-meta {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.3rem;
    font-style: italic;
    color: var(--dark);
    margin: 0 0 0.5rem 0;
  }

  .article-excerpt {
    font-family: "Standard", sans-serif;
    font-size: 1rem;
    line-height: 1.5;
    color: var(--dark);
    margin: 0;
    overflow: visible;
    white-space: normal;
  }

  @media (max-width: 768px) {
    .article-title {
      font-size: 1.8rem;
    }
  }
</style>
