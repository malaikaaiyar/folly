---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { site } from "../../site";

// Get all stories and sort them by date
export async function getStaticPaths({ paginate }) {
  const allStories = await getCollection("articles");
  
  // Sort stories by date if available, otherwise don't sort
  const sortedStories = allStories.sort((a, b) => {
    // Check if both stories have a date property
    if (a.data.date && b.data.date) {
      return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
    }
    // If only one has a date, prioritize the one with a date
    if (a.data.date) return -1;
    if (b.data.date) return 1;
    // If neither has a date, sort alphabetically by title
    return a.data.title.localeCompare(b.data.title);
  });

  // Paginate the stories
  return paginate(sortedStories, { pageSize: 10 });
}

const { page } = Astro.props;
---

<Layout title={site.pages.stories.title}>
  <main>
    <h1>Stories</h1>
    <div class="stories-list">
      {page.data.map((story) => (
        <div class="story-item">
          <h2>
            <a href={`/stories/${story.slug}`}>
              {story.data.title}
            </a>
          </h2>
          <p class="story-meta">
            {story.data.author}
            {story.data.date && (
              <span> | {new Date(story.data.date).toLocaleDateString()}</span>
            )}
          </p>
          {story.data.description && (
            <p class="story-description">{story.data.description}</p>
          )}
        </div>
      ))}
    </div>
    
    <!-- Pagination -->
    <div class="pagination">
      {page.url.prev && (
        <a href={page.url.prev} class="prev-page">Previous</a>
      )}
      {page.url.next && (
        <a href={page.url.next} class="next-page">Next</a>
      )}
    </div>
  </main>
</Layout>

<style>
  main {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  h1 {
    font-size: 2.5rem;
    margin-bottom: 2rem;
  }
  
  .stories-list {
    margin-top: 2rem;
  }
  
  .story-item {
    margin-bottom: 2rem;
  }
  
  .story-item h2 {
    margin-bottom: 0.5rem;
    font-size: 1.8rem;
  }
  
  .story-meta {
    font-style: italic;
    margin-top: 0.25rem;
    color: #666;
  }
  
  .story-description {
    margin-top: 0.5rem;
  }
  
  a {
    text-decoration: none;
    color: inherit;
  }
  
  a:hover {
    text-decoration: underline;
  }
  
  .pagination {
    display: flex;
    justify-content: space-between;
    margin-top: 3rem;
  }
  
  .prev-page, .next-page {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
</style>
