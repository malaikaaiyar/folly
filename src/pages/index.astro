---
import { site } from "../site"
import Layout from "../layouts/Layout.astro"
import { getCollection } from "astro:content"
import { formatTitle } from "../utils.js"

const featuredSlugs = ["boyish-sun", "education", "cruisers"]
const allArticles = await getCollection("articles")
const homepageArticles = featuredSlugs
  .map((slug) => allArticles.find((a) => a.slug === slug))
  .filter(Boolean)
---

<Layout
  title={site.pages.index.title}
  desc={site.pages.index.description}
  rightColumnImage="/images/godstow-home.png"
  rightColumnCaption="Godstow Abbey, Oxfordshire. Photograph by Malaika Aiyar"
  noImageFallback
  captionRevealOnHover
>
  <section class="index-content">
    <div class="content-container-index">
      <div class="index-intro">
        <p class="index-description">
          An Oxford magazine publishing fiction, poetry, criticism, and essays on politics and culture.
        </p>
      </div>

      <div class="articles-preview">
        {homepageArticles.map((article) => (
          <article class="article-preview">
            <h2 class="article-title">
              <a href={`/articles/${article.slug}`} set:html={formatTitle(article.data.title)}></a>
            </h2>
            <p class="article-meta">{article.data.author} | {article.data.category}</p>
            {article.data.description && (
              <p class="article-excerpt" set:html={article.data.description} />
            )}
          </article>
        ))}
      </div>

      <a href="/magazine/volume-2" class="read-volume">Read Volume 2 â†’</a>
    </div>
  </section>
</Layout>

<style>
  .index-content {
    background: var(--light);
    color: var(--dark);
  }

  .index-intro {
    margin-bottom: 3rem;
  }

  .index-description {
    font-family: 'Standard', sans-serif;
    font-size: 1rem;
    line-height: 1.5;
    margin: 0 0 0.5rem 0;
  }

  .index-meta {
    font-family: 'Libre Baskerville', serif;
    font-size: 0.95rem;
    color: var(--dark);
    opacity: 0.9;
    margin: 0;
  }

  .articles-preview {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .article-preview {
    max-width: 100%;
  }

  .article-title {
    font-family: 'Libre Baskerville', serif;
    font-size: 2rem;
    font-weight: 400;
    line-height: 1.2;
    margin: 0 0 0.25rem 0;
  }

  .article-title a {
    color: var(--dark);
    text-decoration: none;
  }


  .article-meta {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.3rem;
    font-style: italic;
    color: var(--dark);
    margin: 0 0 0.5rem 0;
  }

  .article-excerpt {
    font-family: "Standard", sans-serif;
    font-size: 1rem;
    line-height: 1.5;
    color: var(--dark);
    margin: 0;
    overflow: visible;
    white-space: normal;
  }

  .read-volume {
    display: inline-block;
    margin-top: 2rem;
    font-family: 'Libre Baskerville', serif;
    font-size: 1.25rem;
    color: var(--dark);
    text-decoration: none;
  }


  @media (max-width: 768px) {
    .article-title {
      font-size: 1.8rem;
    }
  }
</style>
